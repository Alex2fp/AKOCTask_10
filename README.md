# Система суммирования

Эта программа демонстрирует многопоточный конвейер суммирования с использованием POSIX-потоков и синхронизируемых разделяемых ресурсов. Сто потоков-производителей генерируют случайные целые числа, диспетчер координирует попарное объединение значений для вычислений, а потоки-сумматоры итеративно уменьшают содержимое буфера, пока не останется один результат.

## Архитектура

* **Производители (100 потоков):** Каждый поток спит 1–7 секунд, генерирует случайное целое число (1–100), помещает его в общий буфер, логирует действие и завершает работу.
* **Ограниченный буфер:** Кольцевая очередь с мьютексом и двумя условными переменными, обеспечивающими блокирующие операции вставки и извлечения. Вместимость по умолчанию — 128, чтобы уместить все значения от производителей.
* **Диспетчер:** Ожидает без активного ожидания. Когда доступно как минимум два элемента, он удаляет пару и создаёт поток-сумматор. Отслеживает активные сумматоры и завершает работу только тогда, когда производители закончили, сумматоров не осталось, а в буфере находится один финальный элемент.
* **Сумматоры:** Спят 3–6 секунд, вычисляют сумму своей пары, помещают результат обратно в буфер, логируют прогресс и уменьшают счётчик активных сумматоров.
* **Логирование:** Потокобезопасный вывод с относительными метками времени в stdout для воспроизводимых и читаемых трасс.

## Сборка

```sh
make
```

Эта команда компилирует исполняемый файл `sum_system` с использованием `gcc` и поддержкой POSIX-потоков.

## Запуск

```sh
./sum_system
```

При каждом запуске разные начальные значения генератора случайных чисел приводят к различным задержкам и значениям, но структура протокола остаётся детерминированной: потоки логируют сообщения о начале и завершении работы, а диспетчер сообщает итоговое значение, когда в буфере остаётся только одно число.

## Структура проекта

* `main.c` — инициализирует разделяемое состояние, запускает производителей и диспетчер, ожидает завершения потоков и выводит финальные сообщения.
* `buffer.c` / `buffer.h` — реализация ограниченной очереди с блокирующими операциями вставки и извлечения, использующая мьютексы и условные переменные.
* `workers.c` / `workers.h` — точки входа потоков и общие счётчики для производителей, диспетчера и сумматоров.
* `log.c` / `log.h` — потокобезопасные утилиты логирования с выводом временных меток.
* `Makefile` — цели сборки (`make`) и очистки (`make clean`).

## Примечания

* Программа избегает гонок данных за счёт аккуратного использования мьютексов и условных переменных; активное ожидание не используется.
* Инициализация генератора случайных чисел выполняется в `main` с помощью `srand(time(NULL))`; потоки используют `rand_r` для потокобезопасной генерации случайных значений.
