# Система суммирования

Эта программа демонстрирует конвейер суммирования на основе POSIX-потоков и синхронизированных общих ресурсов. Сто потоков-производителей генерируют случайные целые числа, диспетчер координирует выдачу пар значений на обработку, а потоки-сумматоры последовательно сворачивают буфер до единственного результата.

## Архитектура

- **Производители (100 потоков):** засыпают на 1–7 секунд, генерируют случайное число (1–100), помещают его в общий буфер, логируют действие и завершаются.
- **Ограниченный буфер:** кольцевая очередь с мьютексом и двумя условными переменными для блокирующих операций вставки/извлечения. Ёмкость по умолчанию — 128, чтобы уместить все значения производителей.
- **Диспетчер:** ждёт события без активного опроса. Как только есть минимум два элемента, извлекает пару, создаёт сумматор и ведёт учёт активных сумматоров. Завершается, когда все производители отработали, сумматоров не осталось, а в буфере лежит единственный элемент.
- **Сумматоры:** спят 3–6 секунд, складывают полученную пару, возвращают сумму в буфер, логируют прогресс и уменьшают счётчик активных сумматоров.
- **Логирование:** потокобезопасная печать с относительными метками времени на stdout для воспроизводимых, читабельных трасс.

## Сборка

```sh
make
```

Команда собирает исполняемый файл `sum_system` при помощи `gcc` с поддержкой POSIX threads.

## Запуск

```sh
./sum_system
```

При каждом запуске из-за случайных задержек и значений поведение немного отличается, но протокол остаётся детерминированным: потоки фиксируют старт и завершение, а диспетчер сообщает итоговое значение, когда в буфере остаётся единственное число.

## Структура проекта

- `main.c` — инициализация общих структур, запуск производителей и диспетчера, ожидание завершения и финальный вывод.
- `buffer.c` / `buffer.h` — реализация ограниченной очереди с блокирующими операциями вставки/извлечения на мьютексах и условных переменных.
- `workers.c` / `workers.h` — точки входа потоков и общие счётчики для производителей, диспетчера и сумматоров.
- `log.c` / `log.h` — потокобезопасные утилиты логирования с временными метками.
- `Makefile` — цели сборки (`make`) и очистки (`make clean`).

## Замечания

- Гонки данных предотвращаются за счёт строгого использования мьютексов и condvar; активное ожидание отсутствует.
- Сид задаётся в `main` через `srand(time(NULL))`, в потоках используется `rand_r` для потокобезопасной генерации случайных чисел.
